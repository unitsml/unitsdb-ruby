= UnitsDB in Ruby (UnitsML)

== Purpose

UnitsML is a standard for units of measure, and UnitsDB is the database
that contains enumerative elements used by UnitsML.

UnitsDB includes the following content:

* Unit systems
* Units of measure
* Prefixes
* Constants
* Quantities

Such content is hosted at the official UnitsDB repository at
https://github.com/unitsml/unitsdb.

This repository contains the Ruby codebase for UnitsDB, which is used
to access and manipulate the UnitsDB content.

== Install

[source,sh]
----
$ gem install unitsdb
----

== Usage: CLI

The UnitsDB gem includes a command-line utility for working with UnitsDB data.
This tool provides several commands for validating and normalizing UnitsDB
content.

=== Installation

The `unitsdb` command is automatically installed when you install the gem.

=== Available commands

==== Check uniqueness

Checks for uniqueness of 'short' and 'id' fields in YAML files.

[source,sh]
----
$ unitsdb check_uniqueness [INPUT]
$ unitsdb check_uniqueness --all --dir=/path/to/unitsdb/data
----

Options:

`--all`, `-a`:: Check all YAML files in the repository
`--dir`, `-d`:: Directory containing the YAML files (default: current directory)

==== Normalize YAML

Normalizes YAML file format:

[source,sh]
----
$ unitsdb normalize [INPUT] [OUTPUT]
$ unitsdb normalize --all --dir=/path/to/unitsdb/data
----

Options:

`--all`, `-a`:: Normalize all YAML files in the repository
`--dir`, `-d`:: Directory containing the YAML files (default: current directory)
`--sort`:: Sort keys alphabetically (default: true)

==== Validate

Validates UnitsDB data for different conditions:

[source,sh]
----
# Validate references between entities
$ unitsdb validate references check --all --dir=/path/to/unitsdb/data

# Check for uniqueness of 'short' and 'id' fields
$ unitsdb validate uniqueness check --all --dir=/path/to/unitsdb/data
----

Options for both subcommands:

`--all`, `-a`:: Process all YAML files in the repository
`--dir`, `-d`:: Directory containing the YAML files (default: current directory)

The references validator also supports:

`--debug_registry`:: Show registry contents for debugging
`--print_valid`:: Print valid references too

==== Search

Searches for entities in the database:

[source,sh]
----
# Search by text content
$ unitsdb search meter
$ unitsdb search meter --type=units --dir=/path/to/unitsdb/data

# Search by ID
$ unitsdb search any-query --id=NISTu1
$ unitsdb search any-query --id=NISTu1 --id_type=nist
----

Options:

`--type`, `-t`:: Entity type to search (units, prefixes, quantities, dimensions, unit_systems)
`--id`, `-i`:: Search for an entity with a specific identifier
`--id_type`:: Filter the ID search by identifier type
`--dir`, `-d`:: Directory containing the YAML files (default: current directory)

=== Examples

Check uniqueness in a directory:

[source,sh]
----
$ unitsdb check_uniqueness --all --dir=/path/to/unitsdb/data
----

Normalize all files in a directory:

[source,sh]
----
$ unitsdb normalize --all --dir=/path/to/unitsdb/data
----

Validate references in a specific directory:

[source,sh]
----
$ unitsdb validate references check --all --dir=/path/to/unitsdb/data
----



== Usage: Ruby

=== Loading the database

The primary way to load the UnitsDB data is through the `Database.from_db` method, which reads data from YAML files:

[source,ruby]
----
require 'unitsdb'

# Load from the UnitsDB data directory
db = Unitsdb::Database.from_db('/path/to/unitsdb/data')

# Access different collections
units = db.units
prefixes = db.prefixes
dimensions = db.dimensions
quantities = db.quantities
unit_systems = db.unit_systems
----

=== Database search methods

The UnitsDB Ruby gem provides several methods for searching and retrieving entities.

==== Search by text content

The `search` method allows you to find entities containing specific text in their identifiers, names, or descriptions:

[source,ruby]
----
# Search across all entity types
results = db.search(text: "meter")

# Search within a specific entity type
units_with_meter = db.search(text: "meter", type: "units")
----

==== Find entity by ID

The `get_by_id` method finds an entity with a specific identifier across all entity types:

[source,ruby]
----
# Find by ID across all entity types
meter_entity = db.get_by_id(id: "NISTu1")

# Find by ID with specific identifier type
meter_entity = db.get_by_id(id: "NISTu1", type: "nist")
----

==== Find entity by ID within a specific type collection

The `find_by_type` method searches for an entity by ID within a specific entity type collection:

[source,ruby]
----
# Find unit with specific ID
meter_unit = db.find_by_type(id: "NISTu1", type: "units")
----

=== Main Classes

The UnitsDB Ruby gem provides the following main classes.

==== Database

The `Database` class is the main container that holds all UnitsML components. It loads and provides access to units, prefixes, dimensions, quantities, and unit systems.

[source,ruby]
----
# Access database collections
db.units       # => Array of Unit objects
db.prefixes    # => Array of Prefix objects
db.dimensions  # => Array of Dimension objects
db.quantities  # => Array of Quantity objects
db.unit_systems # => Array of UnitSystem objects
----

==== Unit

The `Unit` class represents units of measure with their properties and relationships:

* Identifiers
* Short name
* Whether it's a root unit or can be prefixed
* Dimension reference
* Unit system references
* Unit names
* Symbol presentations
* Quantity references
* SI derived bases
* Root unit references

==== Prefix

The `Prefix` class represents prefixes for units (like kilo-, mega-, etc.):

* Identifiers
* Name
* Symbol presentations
* Base (e.g., 10)
* Power (e.g., 3 for kilo)

==== Dimension

The `Dimension` class represents physical dimensions (like length, mass, etc.):

* Identifiers
* Whether it's dimensionless
* Basic dimensions (length, mass, time, etc.)
* Dimension details (power, symbol, dimension symbols)
* Short name

==== UnitSystem

The `UnitSystem` class represents systems of units (like SI, Imperial, etc.):

* Identifiers
* Name
* Short name
* Whether it's acceptable

==== Quantity

The `Quantity` class represents physical quantities that can be measured:

* Identifiers
* Quantity type
* Quantity names
* Short name
* Unit references
* Dimension reference

=== Database files

The `Database.from_db` method reads the following YAML files:

* `prefixes.yaml` - Contains prefix definitions (e.g., kilo-, mega-)
* `dimensions.yaml` - Contains dimension definitions (e.g., length, mass)
* `units.yaml` - Contains unit definitions (e.g., meter, kilogram)
* `quantities.yaml` - Contains quantity definitions (e.g., length, mass)
* `unit_systems.yaml` - Contains unit system definitions (e.g., SI, Imperial)


== License

Copyright Ribose. BSD 2-clause license.
